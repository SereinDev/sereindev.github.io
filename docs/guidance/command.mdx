# 命令

用一段文字表示 Serein 需要执行的内容

- [生成器](#生成器)
- [语法结构](#语法结构)
  - [参数格式](#参数格式)
    - [`target`](#target)
    - [`auto_escape`](#auto_escape)
    - [`as_segments`](#as_segments)
    - [`use_unicode`](#use_unicode)
    - [`self`](#self)
  - [示例](#示例)
- [命令类型](#命令类型)
  - [发送群组消息](#发送群组消息)
  - [发送频道消息](#发送频道消息)
  - [发送群聊消息](#发送群聊消息)
  - [发送私聊消息](#发送私聊消息)
  - [发送回复](#发送回复)
  - [通过 连接功能 发送文本](#通过-连接功能-发送文本)
  - [发送指令到服务器](#发送指令到服务器)
  - [绑定](#绑定)
  - [解绑](#解绑)
  - [在插件的 Js 引擎中执行代码](#在插件的-js-引擎中执行代码)
  - [执行 Shell 命令](#执行-shell-命令)
- [命令来源](#命令来源)

## 生成器

import CommandGenerator from "@site/src/components/CommandGenerator";

<CommandGenerator />

## 语法结构

```txt
[类型:参数]主体
```

:::note

为了防止出现注入攻击，其中只有**主体**部分才能插入[变量](./variables)

:::

### 参数格式

参数支持键值对语法，多个参数用逗号分隔：

```txt
[类型:key1=value1, key2=value2]主体
```

当参数无法解析成键值对时，会将此值自动赋值给`target`参数

:::tip

在下面的例子中，二者是等价的

- `[group:123456]一条消息`
- `[group:target=123456]一条消息`

:::

#### `target`

目标ID（群聊/用户/服务器/插件 Id等）

#### `auto_escape`

:::note

仅在使用 OneBot V11 适配器发送消息时生效

:::

是否[使用纯文本](https://github.com/botuniverse/onebot-11/blob/master/api/public.md#send_msg-%E5%8F%91%E9%80%81%E6%B6%88%E6%81%AF)发送，对应 设置>连接>OneBot 中的 **纯文本发送** 选项

可用的值：`true`/`false`

#### `as_segments`

:::note

仅在使用 OneBot V12 适配器发送消息时生效

:::

是否分段发送消息

若值为`true`，在发送消息时会将主体作为[消息段](https://12.onebot.dev/interface/message/type/)数组的 JSON 文本进行解析，然后发送该消息段

可用的值：`true`/`false`

#### `use_unicode`

是否使用 Unicode 编码，对应 服务器配置>输入/输出 中的 **使用 Unicode 编码** 选项

可用的值：`true`/`false`

#### `self`

:::note

仅在适用于 OneBot V12 和 Satori 协议

:::

指定发送消息使用的发送者

格式：`平台名称.用户Id`，如`qq.123456`

:::tip

你也可以分开指定平台名称和用户 Id，即在下面的例子中，二者是等价的

- `self=qq.123456`
- `self.platform=qq,self.id=123456`

:::

### 示例

```regex
[g:114514]hello world!
```

- `[g:114514]` 命令头
  - `[...]`将命令头包裹起来，避免出现歧义
  - `g` 为此命令的类型——发送群聊消息
  - `:` 隔开命令类型和参数
  - `114514` 参数——此处为要发送的群号
- `hello world!`执行的内容——此处为发送的消息文本
  - 你可以在这里插入[变量](./variables)

## 命令类型

| 类型                           | 全称         | 简写  |
| ------------------------------ | ------------ | :---: |
| 发送群组消息（Guild）          | `guild`      |   -   |
| 发送频道消息（Channel）        | `channel`    |  `c`  |
| 发送群聊消息（Group）          | `group`      |  `g`  |
| 发送私聊消息（Direct/Private） | `private`    |  `p`  |
| 发送回复                       | `reply`      |  `r`  |
| 通过 连接功能 发送文本         | `data`       |  `d`  |
| 发送指令到服务器               | `server`     |  `s`  |
| 绑定                           | `bind`       |  `b`  |
| 解绑                           | `unbind`     | `ub`  |
| 在插件的 Js 引擎中执行代码     | `javascript` | `js`  |
| 执行 Shell 命令                | `cmd`        |   -   |
| 调试输出                       | `debug`      |   -   |

### 发送群组消息

:::note

只适用于 OneBot V12 协议

:::

- 参数
  - 目标：群组 Id（非必须，见下）
- 主体：发送的内容

当群组 Id 未指定时，将按以下顺序获取可能的值

- 执行来源为**群组消息**时，使用该群组 Id
- 其他情况下，使用设置中的第一个监听群组

### 发送频道消息

:::note

不适用于 OneBot V11 协议

:::

- 参数：频道 Id（非必须，见下）
- 主体：发送的内容

当频道 Id 未指定时，将按以下顺序获取可能的值

- 执行来源为**频道消息**时，使用该频道的 Id
- 其他情况下，使用设置中的第一个监听频道

### 发送群聊消息

- 参数
  - 目标：群聊 Id（非必须，见下）
- 主体：发送的内容

当群聊 Id 未指定时，将按以下顺序获取可能的值

- 执行来源为**群聊消息**时，使用该群的群号
- 执行来源为反应中与群聊有关的内容时，使用相关联的群聊 Id
  - 进群/退群/戳一戳
- 其他情况下，使用设置中的第一个监听群聊

### 发送私聊消息

- 参数
  - 目标：用户 Id（非必须，见下）
- 主体：发送的内容

当用户 Id 未指定时，将按以下顺序获取可能的值

- 执行来源为消息时，使用发送这条消息的用户
- 执行来源为反应中与群聊有关的内容时，使用相关联的用户 Id
  - 进群/退群/戳一戳

### 发送回复

- 参数
  - 目标：用户 Id（非必须，见下）
- 主体：发送的内容

根据命令的[来源](#命令来源)不同，此功能等效于发送[群聊消息](#发送群聊消息)或[私聊消息](#发送私聊消息)

### 通过 连接功能 发送文本

:::note

不适用于 Satori 协议

:::

- 参数：无
- 主体：发送的内容

### 发送指令到服务器

- 参数：服务器 Id（非必须，见下）
- 主体：发送的内容
  - 若发送内容为`start`且服务器不在运行时，则会启动服务器
  - 其他情况下将会作为原文发送

当服务器 Id 未指定时，将按以下顺序获取可能的值

- 执行来源为反应中与服务器有关的内容时，使用相关联的服务器 Id
  - 服务器启动/正常退出/非正常退出
- 当前只有一个服务器配置时，使用此服务器的 Id

### 绑定

- 参数：无
- 主体：绑定的 Id

:::note

此命令只能通过群聊消息触发（即[来源](#命令来源)为消息）

:::

### 解绑

- 参数：无
- 主体：解绑的ID

:::note

此命令只能通过群聊消息触发（即[来源](#命令来源)为消息）

:::

### 在插件的 Js 引擎中执行代码

- 参数
  - 目标：插件 Id
- 主体：执行的代码内容

### 执行 Shell 命令

- 参数：无
- 主体：执行的内容

## 命令来源

在 Serein 内部用于指示这条命令执行的来源，命令的来源不同可能会影响命令的实际效果

- 消息
- 服务器输出
- 服务器输入
- 定时任务
- 反应功能
- 插件执行
